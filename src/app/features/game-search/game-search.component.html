<ion-item lines="none">
  <ion-select
    label="Platform"
    labelPlacement="stacked"
    interface="popover"
    [value]="selectedSearchPlatformIgdbId === null ? '' : selectedSearchPlatformIgdbId"
    (ionChange)="onSearchPlatformChange($any($event).detail.value)"
    >
    <ion-select-option value="">All platforms</ion-select-option>
    @for (platform of searchPlatforms; track platform) {
      <ion-select-option [value]="platform.id">
        {{ getPlatformDisplayName(platform.name, platform.id) }}
      </ion-select-option>
    }
  </ion-select>
</ion-item>

@if (platformErrorMessage.length > 0) {
  <ion-item color="warning" lines="none">
    <ion-label>{{ platformErrorMessage }}</ion-label>
  </ion-item>
}

<ion-searchbar
  placeholder="Search games to add or igdb:<id>"
  [value]="query"
  [debounce]="0"
  (ionInput)="onSearchChange($any($event).detail.value)"
></ion-searchbar>

@if (isLoading || hasSearched || errorMessage.length > 0) {
  <ion-list>
    @if (isLoading) {
      <ion-item lines="none">
        <ion-spinner name="dots" slot="start"></ion-spinner>
        <ion-label>Searching games...</ion-label>
      </ion-item>
    }
    @if (errorMessage.length > 0) {
      <ion-item color="danger" lines="none">
        <ion-label>{{ errorMessage }}</ion-label>
      </ion-item>
    }
    @if (!isLoading && hasSearched && results.length === 0 && errorMessage.length === 0) {
      <ion-item lines="none">
        <ion-label>No games found.</ion-label>
      </ion-item>
    }
    @for (result of results; track trackByExternalId($index, result)) {
      <ion-item>
        <div slot="start" class="game-art">
          <img [src]="result.coverUrl || 'assets/icon/placeholder.png'" [alt]="result.title" (error)="onImageError($event)" />
        </div>
        <ion-label>
          <h2>{{ result.title }}</h2>
          @if (getGameTypeBadgeLabel(result); as gameTypeBadgeLabel) {
            <ion-badge class="game-type-badge">{{ gameTypeBadgeLabel }}</ion-badge>
          }
          <p>{{ getPlatformLabel(result) }} â€¢ {{ result.releaseYear || 'Unknown year' }}</p>
        </ion-label>
        <ion-button
          slot="end"
          fill="outline"
          size="small"
          [disabled]="isAdding(result.igdbGameId)"
          (click)="addGame(result)"
          >
          {{ getActionLabel(result.igdbGameId) }}
        </ion-button>
      </ion-item>
    }
  </ion-list>
}
