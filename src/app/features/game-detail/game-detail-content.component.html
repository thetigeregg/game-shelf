<div class="detail-content-inner" [class.detail-content-inner-under-header]="context === 'library'">
  <ion-grid class="detail-layout-grid" fixed>
    <ion-row>
      <ion-col size="12" size-xl="6">
        <div class="detail-cover">
          <div
            class="detail-cover-backdrop"
            [style.background-image]="game.coverUrl ? 'url(' + game.coverUrl + ')' : 'none'"
          ></div>
          <img
            [src]="game.coverUrl || 'assets/icon/placeholder.png'"
            [alt]="displayTitle"
            (load)="onImageLoad($event)"
            (error)="onImageError($event)"
          />
        </div>
        <ion-list lines="full">
          <ion-item>
            <ion-icon slot="start" name="game-controller" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>Name</h2>
              <p class="detail-game-name">{{ displayTitle }}</p>
              @if (gameTypeBadgeLabel; as gameTypeBadgeLabelValue) {
                <ion-badge class="game-type-badge detail-game-type-badge">
                  {{ gameTypeBadgeLabelValue }}
                </ion-badge>
              }
            </ion-label>
            @if (showAddToLibraryAction) {
              <ion-button
                slot="end"
                size="default"
                [disabled]="isAddToLibraryLoading || isInLibrary"
                (click)="addToLibrary.emit()"
              >
                {{
                  isInLibrary
                    ? 'In Library'
                    : isAddToLibraryLoading
                      ? 'Adding...'
                      : 'Add to Library'
                }}
              </ion-button>
            }
          </ion-item>
          <ion-item>
            <ion-icon slot="start" name="hardware-chip" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>{{ platformHeadingLabel }}</h2>
              <p>{{ platformValueLabel }}</p>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-icon slot="start" name="calendar" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>Release Date</h2>
              <p>{{ formatDate(game.releaseDate) }}</p>
            </ion-label>
          </ion-item>
          @if (showLibrarySections) {
            <ion-item>
              <ion-icon slot="start" name="trophy" aria-hidden="true"></ion-icon>
              <ion-select
                label="Status"
                labelPlacement="stacked"
                placeholder="Select status"
                [value]="statusValue"
                (ionChange)="emitStatusChange($any($event).detail.value)"
              >
                @for (option of statusOptions; track option) {
                  <ion-select-option [value]="option.value">
                    {{ option.label }}
                  </ion-select-option>
                }
              </ion-select>
              <ion-button
                slot="end"
                class="detail-clear-button"
                color="medium"
                aria-label="Clear status"
                (click)="clearStatus.emit()"
              >
                CLEAR
              </ion-button>
            </ion-item>
          }

          @if (showLibrarySections) {
            <ion-item>
              <ion-icon slot="start" name="star" aria-hidden="true"></ion-icon>
              <ion-select
                label="Rating"
                labelPlacement="stacked"
                placeholder="Select rating"
                [value]="ratingValue"
                (ionChange)="emitRatingChange($any($event).detail.value)"
              >
                @for (rating of ratingOptions; track rating) {
                  <ion-select-option [value]="rating">
                    {{ rating }}
                  </ion-select-option>
                }
              </ion-select>
              <ion-button
                slot="end"
                class="detail-clear-button"
                color="medium"
                aria-label="Clear rating"
                (click)="clearRating.emit()"
              >
                CLEAR
              </ion-button>
            </ion-item>
          }

          @if (showLibrarySections) {
            <ion-item button detail="false" (click)="openTags.emit()">
              <ion-icon slot="start" name="pricetags" aria-hidden="true"></ion-icon>
              <ion-label>
                <h2>Tags</h2>
                @if (tagItems.length > 0) {
                  <div class="game-tags">
                    @for (tag of tagItems; track tag) {
                      <ion-badge
                        [style.--background]="tag.color"
                        [style.color]="getTagTextColor(tag.color)"
                      >
                        {{ tag.name }}
                      </ion-badge>
                    }
                  </div>
                } @else {
                  <p>None</p>
                }
              </ion-label>
            </ion-item>
          }
        </ion-list>
      </ion-col>
      <ion-col size="12" size-xl="6">
        <ion-list lines="full">
          <ion-item
            button
            detail="false"
            class="detail-text-item"
            (click)="toggleDetailText('summary')"
          >
            <ion-icon slot="start" name="document-text" aria-hidden="true"></ion-icon>
            <ion-label class="detail-text-label">
              <h2>Summary</h2>
              <p
                class="detail-long-text"
                [class.detail-long-text-collapsed]="!isDetailTextExpanded('summary')"
              >
                {{ game.summary || 'None' }}
              </p>
              @if (shouldShowDetailTextToggle(game.summary)) {
                <ion-button
                  fill="clear"
                  size="small"
                  class="detail-text-toggle"
                  (click)="$event.stopPropagation(); toggleDetailText('summary')"
                >
                  {{ isDetailTextExpanded('summary') ? 'Show less' : 'Show more' }}
                </ion-button>
              }
            </ion-label>
          </ion-item>
          <ion-item
            button
            detail="false"
            class="detail-text-item"
            (click)="toggleDetailText('storyline')"
          >
            <ion-icon slot="start" name="book" aria-hidden="true"></ion-icon>
            <ion-label class="detail-text-label">
              <h2>Storyline</h2>
              <p
                class="detail-long-text"
                [class.detail-long-text-collapsed]="!isDetailTextExpanded('storyline')"
              >
                {{ game.storyline || 'None' }}
              </p>
              @if (shouldShowDetailTextToggle(game.storyline)) {
                <ion-button
                  fill="clear"
                  size="small"
                  class="detail-text-toggle"
                  (click)="$event.stopPropagation(); toggleDetailText('storyline')"
                >
                  {{ isDetailTextExpanded('storyline') ? 'Show less' : 'Show more' }}
                </ion-button>
              }
            </ion-label>
          </ion-item>

          <ion-item
            [button]="showLibrarySections && hasMetadataValue(game.developers)"
            [detail]="showLibrarySections && hasMetadataValue(game.developers)"
            (click)="onDeveloperClick()"
          >
            <ion-icon slot="start" name="build" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>Developer</h2>
              <p>{{ formatMetadataList(game.developers) }}</p>
            </ion-label>
          </ion-item>

          <ion-item
            [button]="showLibrarySections && hasMetadataValue(game.collections)"
            [detail]="showLibrarySections && hasMetadataValue(game.collections)"
            (click)="onSeriesClick()"
          >
            <ion-icon slot="start" name="library" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>Series</h2>
              <p>{{ formatMetadataList(game.collections) }}</p>
            </ion-label>
          </ion-item>

          <ion-item
            [button]="showLibrarySections && hasMetadataValue(game.franchises)"
            [detail]="showLibrarySections && hasMetadataValue(game.franchises)"
            (click)="onFranchiseClick()"
          >
            <ion-icon slot="start" name="git-branch" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>Franchise</h2>
              <p>{{ formatMetadataList(game.franchises) }}</p>
            </ion-label>
          </ion-item>

          <ion-item
            [button]="showLibrarySections && hasMetadataValue(game.genres)"
            [detail]="showLibrarySections && hasMetadataValue(game.genres)"
            (click)="onGenreClick()"
          >
            <ion-icon slot="start" name="grid" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>Genres</h2>
              <p>{{ formatMetadataList(game.genres) }}</p>
            </ion-label>
          </ion-item>

          <ion-item
            [button]="showLibrarySections && hasMetadataValue(game.publishers)"
            [detail]="showLibrarySections && hasMetadataValue(game.publishers)"
            (click)="onPublisherClick()"
          >
            <ion-icon slot="start" name="business" aria-hidden="true"></ion-icon>
            <ion-label>
              <h2>Publisher</h2>
              <p>{{ formatMetadataList(game.publishers) }}</p>
            </ion-label>
          </ion-item>

          @if (showLibrarySections) {
            <ion-item>
              <ion-label>
                <h2>HLTB Main Story</h2>
                <p>{{ hltbMainLabel }}</p>
              </ion-label>
            </ion-item>
          }

          @if (showLibrarySections) {
            <ion-item>
              <ion-label>
                <h2>HLTB Main + Extras</h2>
                <p>{{ hltbMainExtraLabel }}</p>
              </ion-label>
            </ion-item>
          }

          @if (showLibrarySections) {
            <ion-item>
              <ion-label>
                <h2>HLTB Completionist</h2>
                <p>{{ hltbCompletionistLabel }}</p>
              </ion-label>
            </ion-item>
          }
        </ion-list>
        <ng-content select="[detail-secondary-content]"></ng-content>
      </ion-col>
    </ion-row>
  </ion-grid>
</div>
