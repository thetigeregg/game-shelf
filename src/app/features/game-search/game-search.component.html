<ion-item lines="none">
  <ion-select
    label="Platform"
    labelPlacement="stacked"
    interface="popover"
    [value]="selectedSearchPlatformIgdbId === null ? '' : selectedSearchPlatformIgdbId"
    (ionChange)="onSearchPlatformChange($any($event).detail.value)"
  >
    <ion-select-option value="">All platforms</ion-select-option>
    <ion-select-option *ngFor="let platform of searchPlatforms" [value]="platform.id">
      {{ platform.name }}
    </ion-select-option>
  </ion-select>
</ion-item>

<ion-item *ngIf="platformErrorMessage.length > 0" color="warning" lines="none">
  <ion-label>{{ platformErrorMessage }}</ion-label>
</ion-item>

<ion-searchbar
  placeholder="Search games to add"
  [value]="query"
  [debounce]="0"
  (ionInput)="onSearchChange($any($event).detail.value)"
></ion-searchbar>

<ion-list *ngIf="isLoading || hasSearched || errorMessage.length > 0">
  <ion-item *ngIf="isLoading" lines="none">
    <ion-spinner name="dots" slot="start"></ion-spinner>
    <ion-label>Searching games...</ion-label>
  </ion-item>

  <ion-item *ngIf="errorMessage.length > 0" color="danger" lines="none">
    <ion-label>{{ errorMessage }}</ion-label>
  </ion-item>

  <ion-item *ngIf="!isLoading && hasSearched && results.length === 0 && errorMessage.length === 0" lines="none">
    <ion-label>No games found.</ion-label>
  </ion-item>

  <ion-item *ngFor="let result of results; trackBy: trackByExternalId">
    <div slot="start" class="game-art">
      <img [src]="result.coverUrl || 'assets/icon/favicon.png'" [alt]="result.title" (error)="onImageError($event)" />
    </div>

    <ion-label>
      <h2>{{ result.title }}</h2>
      <ion-badge *ngIf="getCoverSourceLabel(result) as coverSourceLabel" color="tertiary">{{ coverSourceLabel }}</ion-badge>
      <p>{{ getPlatformLabel(result) }} â€¢ {{ result.releaseYear || 'Unknown year' }}</p>
    </ion-label>

    <ion-button
      slot="end"
      fill="outline"
      size="small"
      [disabled]="isAdding(result.igdbGameId)"
      (click)="addGame(result)"
    >
      {{ getActionLabel(result.igdbGameId) }}
    </ion-button>
  </ion-item>
</ion-list>
