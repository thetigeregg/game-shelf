<app-game-filters-menu
  [menuId]="menuId"
  [contentId]="contentId"
  [platformOptions]="platformOptions"
  [genreOptions]="genreOptions"
  [tagOptions]="tagOptions"
  [filters]="filters"
  (filtersChange)="onFiltersChange($event)"
></app-game-filters-menu>

<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <div class="page-title">Collection</div>
      <div class="page-subtitle">{{ getDisplayedGamesLabel() }}</div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button aria-label="Open filters" (click)="openFiltersMenu()">
        <ion-icon slot="icon-only" name="filter"></ion-icon>
      </ion-button>
      <ion-button aria-label="Open collection actions" [id]="headerActionsTriggerId">
        <ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar
      placeholder="Search collection"
      [value]="listSearchQuery"
      (ionInput)="onListSearchChange($any($event).detail.value)"
    ></ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [id]="contentId">
  <ion-popover [trigger]="headerActionsTriggerId" triggerAction="click">
    <ng-template>
      <ion-content>
        <ion-list lines="none">
          <ion-item>
            <ion-label>Group by</ion-label>
            <ion-select
              [value]="groupBy"
              interface="popover"
              (ionChange)="onGroupByChange($any($event).detail.value)"
            >
              <ion-select-option *ngFor="let option of groupByOptions" [value]="option.value">
                {{ option.label }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item button detail="false" (click)="pickRandomGameFromPopover()">
            Pick random game
          </ion-item>
          <ion-item button detail="false" (click)="openSettingsFromPopover()">
            Settings
          </ion-item>
          <ion-item button detail="false" (click)="openTagsFromPopover()">
            Tags
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-popover>

  <app-game-list
    [listType]="listType"
    [filters]="filters"
    [searchQuery]="listSearchQuery"
    [groupBy]="groupBy"
    (platformOptionsChange)="onPlatformOptionsChange($event)"
    (genreOptionsChange)="onGenreOptionsChange($event)"
    (tagOptionsChange)="onTagOptionsChange($event)"
    (displayedGamesChange)="onDisplayedGamesChange($event)"
  ></app-game-list>

  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button aria-label="Add game" (click)="openAddGameModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>

<ion-modal [isOpen]="isAddGameModalOpen" (didDismiss)="closeAddGameModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Add Game</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeAddGameModal()">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <app-game-search [listType]="listType"></app-game-search>
    </ion-content>
  </ng-template>
</ion-modal>
