<ion-list *ngIf="games$ | async as games">
  <ion-item *ngFor="let game of games; trackBy: trackByExternalId" button detail="false" (click)="openGameDetail(game)">
    <div slot="start" class="game-art">
      <img [src]="game.coverUrl || 'assets/icon/favicon.png'" [alt]="game.title" (error)="onImageError($event)" />
    </div>

    <ion-label>
      <h2>{{ game.title }}</h2>
      <ion-badge *ngIf="getCoverSourceLabel(game) as coverSourceLabel" color="tertiary">{{ coverSourceLabel }}</ion-badge>
      <p>{{ game.platform || 'Unknown platform' }} â€¢ {{ game.releaseYear || 'Unknown year' }}</p>
    </ion-label>

    <ion-button
      slot="end"
      fill="clear"
      aria-label="Game actions"
      [id]="getActionsTriggerId(game)"
      (click)="onActionsButtonClick($event)"
    >
      <ion-icon name="ellipsis-horizontal" slot="icon-only"></ion-icon>
    </ion-button>

    <ion-popover [trigger]="getActionsTriggerId(game)" triggerAction="click">
      <ng-template>
        <ion-content>
          <ion-list lines="none">
            <ion-item button detail="false" (click)="moveGameFromPopover(game)">
              Move to {{ getOtherListLabel() }}
            </ion-item>
            <ion-item button detail="false" color="danger" (click)="removeGameFromPopover(game)">
              Delete
            </ion-item>
          </ion-list>
        </ion-content>
      </ng-template>
    </ion-popover>
  </ion-item>

  <ion-item *ngIf="games.length === 0" lines="none">
    <ion-label color="medium">No games match current filters.</ion-label>
  </ion-item>
</ion-list>

<ion-modal [isOpen]="isGameDetailModalOpen" (didDismiss)="closeGameDetailModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Game Details</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeGameDetailModal()">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content *ngIf="selectedGame as game">
      <div class="detail-cover">
        <img [src]="game.coverUrl || 'assets/icon/favicon.png'" [alt]="game.title" (error)="onImageError($event)" />
      </div>

      <ion-list lines="full">
        <ion-item>
          <ion-label>
            <h2>Title</h2>
            <p>{{ game.title }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Platform</h2>
            <p>{{ game.platform || 'Unknown' }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Release Date</h2>
            <p>{{ formatDate(game.releaseDate) }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Release Year</h2>
            <p>{{ game.releaseYear || 'Unknown' }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>List</h2>
            <p>{{ getGameListLabel(game) }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Image Source</h2>
            <p>{{ getCoverSourceLabel(game) || 'Unknown' }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>IGDB ID</h2>
            <p>{{ game.externalId }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Added</h2>
            <p>{{ formatDate(game.createdAt) }}</p>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Last Updated</h2>
            <p>{{ formatDate(game.updatedAt) }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-content>
  </ng-template>
</ion-modal>
